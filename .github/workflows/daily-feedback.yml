name: Daily Feedback Generation

#on:
#  schedule:
    # æ¯æ—¥UTC 19:00 = JST 04:00ã«å®Ÿè¡Œ
#    - cron: '0 19 * * *'
#  workflow_dispatch:
    # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½

jobs:
  generate-daily-feedback:
    runs-on: ubuntu-latest
    
    steps:
      - name: Generate Daily Feedback
        run: |
          echo "ğŸš€ Triggering daily feedback generation..."
          
          # ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç’°å¢ƒã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å‘¼ã³å‡ºã—
          response=$(curl -s -w "%{http_code}" \
            -X POST \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET_TOKEN }}" \
            -H "Content-Type: application/json" \
            "${{ secrets.PRODUCTION_URL }}/api/cron/daily-feedback")
          
          http_code="${response: -3}"
          body="${response%???}"
          
          echo "ğŸ“¡ HTTP Status: $http_code"
          echo "ğŸ“„ Response: $body"
          
          if [ "$http_code" != "200" ]; then
            echo "âŒ Daily feedback generation failed"
            exit 1
          else
            echo "âœ… Daily feedback generation completed successfully"
          fi

      - name: Notify on failure
        if: failure()
        run: |
          echo "ğŸ’¥ Daily feedback generation job failed"
          # ã“ã“ã§é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ï¼ˆSlack, Discordç­‰ï¼‰ã¸ã®é€ä¿¡ã‚‚å¯èƒ½
